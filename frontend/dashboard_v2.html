<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìë™í™” ëŒ€ì‹œë³´ë“œ Final</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }
        
        .navbar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .card-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #94a3b8;
        }
        
        .input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        input, textarea {
            flex: 1;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .task-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .task-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .task-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .task-meta {
            font-size: 0.85rem;
            color: #94a3b8;
        }
        
        .task-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.85rem;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.5);
        }
        
        .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
        
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .badge-completed {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .badge-in_progress {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }
        
        .badge-pending {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
        }
        
        .response-box {
            padding: 1rem;
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            border-radius: 8px;
            margin-top: 1rem;
            min-height: 100px;
            white-space: pre-wrap;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: rgba(34, 197, 94, 0.9);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .alert.show {
            display: block;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-box {
            text-align: center;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">ğŸ¤– AI ìë™í™” ëŒ€ì‹œë³´ë“œ</div>
        <div class="status-indicator">
            <span class="status-dot"></span>
            <span id="serverStatus">ì„œë²„ ì—°ê²° í™•ì¸ì¤‘...</span>
        </div>
    </nav>
    
    <div id="alertBox" class="alert">
        <span id="alertMessage"></span>
    </div>
    
    <div class="container">
        <div class="grid">
            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="card">
                <h3 class="card-title">ğŸ“Š í”„ë¡œì íŠ¸ í†µê³„</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalTasks">0</div>
                        <div class="stat-label">ì „ì²´ ì‘ì—…</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="completedTasks">0</div>
                        <div class="stat-label">ì™„ë£Œ</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="aiGenerations">0</div>
                        <div class="stat-label">AI ìƒì„±</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="uploadedFiles">0</div>
                        <div class="stat-label">íŒŒì¼</div>
                    </div>
                </div>
                <button onclick="manualRefresh()" style="margin-top: 1rem; width: 100%;">
                    ğŸ“ˆ í†µê³„ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
            
            <!-- ì‘ì—… ê´€ë¦¬ ì¹´ë“œ -->
            <div class="card">
                <h3 class="card-title">ğŸ“ ì‘ì—… ê´€ë¦¬</h3>
                <div class="input-group">
                    <input type="text" id="taskInput" placeholder="ìƒˆ ì‘ì—… ì…ë ¥...">
                    <button onclick="addTask()">ì¶”ê°€</button>
                </div>
                <div class="task-list" id="taskList">
                    <!-- ì‘ì—… ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <!-- AI í…ìŠ¤íŠ¸ ìƒì„± ì¹´ë“œ -->
            <div class="card">
                <h3 class="card-title">ğŸ¤– AI í…ìŠ¤íŠ¸ ìƒì„±</h3>
                <textarea id="aiPrompt" rows="3" placeholder="AIì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”... (ì˜ˆ: ì˜¤ëŠ˜ ë­í•˜ì§€? / ì•ˆë…• / ë„ì›€)"></textarea>
                <button onclick="generateAI()" style="width: 100%; margin-top: 0.5rem;">
                    âœ¨ AI ìƒì„±
                </button>
                <div class="response-box" id="aiResponse">
                    ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                </div>
            </div>
            
            <!-- íŒŒì¼ ì—…ë¡œë“œ ì¹´ë“œ -->
            <div class="card">
                <h3 class="card-title">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</h3>
                <input type="file" id="fileInput" accept=".txt,.pdf,.png,.jpg,.jpeg,.gif,.csv,.xlsx,.docx" style="margin-bottom: 1rem; width: 100%;">
                <button onclick="uploadFile()" style="width: 100%;">
                    ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ
                </button>
                <div class="response-box" id="uploadResult">
                    ì—…ë¡œë“œ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ì„œë²„ URL
        const API_URL = 'http://127.0.0.1:5000';
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” (ìë™ ìƒˆë¡œê³ ì¹¨ ì™„ì „ ì œê±°!)
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard ì´ˆê¸°í™” ì‹œì‘...');
            checkServerConnection();
            loadTasks();
            loadStatistics();
        });
        
        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showAlert(message, duration = 3000) {
            const alertBox = document.getElementById('alertBox');
            const alertMessage = document.getElementById('alertMessage');
            alertMessage.textContent = message;
            alertBox.classList.add('show');
            
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, duration);
        }
        
        // ì„œë²„ ì—°ê²° í™•ì¸
        async function checkServerConnection() {
            try {
                const response = await fetch(`${API_URL}/`);
                const data = await response.json();
                
                document.getElementById('serverStatus').textContent = 'ì„œë²„ ì—°ê²°ë¨';
                document.getElementById('serverStatus').style.color = '#22c55e';
                console.log('ì„œë²„ ì—°ê²° ì„±ê³µ:', data);
            } catch (error) {
                document.getElementById('serverStatus').textContent = 'ì„œë²„ ì˜¤í”„ë¼ì¸';
                document.getElementById('serverStatus').style.color = '#ef4444';
                console.error('ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', error);
            }
        }
        
        // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
        function manualRefresh() {
            console.log('ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨...');
            loadTasks();
            loadStatistics();
            showAlert('ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ!');
        }
        
        // í†µê³„ ë¡œë“œ
        async function loadStatistics() {
            try {
                const response = await fetch(`${API_URL}/api/statistics`);
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.data;
                    
                    // ì‘ì—… í†µê³„
                    const totalTasks = (stats.tasks.completed || 0) + 
                                      (stats.tasks.in_progress || 0) + 
                                      (stats.tasks.pending || 0);
                    document.getElementById('totalTasks').textContent = totalTasks;
                    document.getElementById('completedTasks').textContent = stats.tasks.completed || 0;
                    
                    // AI í†µê³„
                    document.getElementById('aiGenerations').textContent = 
                        stats.ai.total_generations || 0;
                    
                    // íŒŒì¼ í†µê³„
                    document.getElementById('uploadedFiles').textContent = 
                        stats.files.total_files || 0;
                }
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì‘ì—… ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadTasks() {
            try {
                const response = await fetch(`${API_URL}/api/tasks`);
                const data = await response.json();
                
                const taskList = document.getElementById('taskList');
                taskList.innerHTML = '';
                
                if (data.data && data.data.length > 0) {
                    data.data.forEach(task => {
                        const taskItem = document.createElement('div');
                        taskItem.className = 'task-item';
                        
                        let badgeClass = 'badge-pending';
                        if (task.status === 'completed') badgeClass = 'badge-completed';
                        else if (task.status === 'in_progress') badgeClass = 'badge-in_progress';
                        
                        taskItem.innerHTML = `
                            <div class="task-info">
                                <div class="task-title">${task.title}</div>
                                <div class="task-meta">
                                    <span class="badge ${badgeClass}">${task.status}</span>
                                </div>
                            </div>
                            <div class="task-actions">
                                ${task.status !== 'completed' ? 
                                    `<button class="btn-small" onclick="updateTaskStatus(${task.id}, 'completed')">âœ“</button>` : ''}
                                <button class="btn-small btn-delete" onclick="deleteTask(${task.id})">Ã—</button>
                            </div>
                        `;
                        taskList.appendChild(taskItem);
                    });
                } else {
                    taskList.innerHTML = '<p style="text-align: center; color: #94a3b8;">ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error('ì‘ì—… ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ìƒˆ ì‘ì—… ì¶”ê°€
        async function addTask() {
            const input = document.getElementById('taskInput');
            const title = input.value.trim();
            
            if (!title) {
                showAlert('ì‘ì—… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/tasks`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('âœ… ì‘ì—…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    input.value = '';
                    loadTasks();
                    loadStatistics();
                }
            } catch (error) {
                showAlert('âš ï¸ ì‘ì—… ì¶”ê°€ ì‹¤íŒ¨');
                console.error('ì‘ì—… ì¶”ê°€ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì‘ì—… ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateTaskStatus(taskId, status) {
            try {
                const response = await fetch(`${API_URL}/api/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('âœ… ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadTasks();
                    loadStatistics();
                }
            } catch (error) {
                console.error('ì‘ì—… ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì‘ì—… ì‚­ì œ
        async function deleteTask(taskId) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch(`${API_URL}/api/tasks/${taskId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('âœ… ì‘ì—…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadTasks();
                    loadStatistics();
                }
            } catch (error) {
                console.error('ì‘ì—… ì‚­ì œ ì˜¤ë¥˜:', error);
            }
        }
        
        // AI í…ìŠ¤íŠ¸ ìƒì„±
        async function generateAI() {
            const promptInput = document.getElementById('aiPrompt');
            const prompt = promptInput.value.trim();
            
            if (!prompt) {
                showAlert('í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            
            const responseBox = document.getElementById('aiResponse');
            responseBox.innerHTML = '<div class="loading"></div> AIê°€ ìƒê°ì¤‘...';
            
            console.log('AI ìƒì„± ìš”ì²­ ì‹œì‘:', prompt);
            
            try {
                const response = await fetch(`${API_URL}/api/ai/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: prompt })
                });
                
                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                const data = await response.json();
                console.log('AI ì‘ë‹µ ë°ì´í„°:', data);
                
                if (data.success && data.response) {
                    responseBox.innerHTML = `<strong>ğŸ¤– AI ì‘ë‹µ:</strong>
${data.response}

<small style="color: #94a3b8;">í† í°: ${data.tokens} | ëª¨ë¸: ${data.model}</small>`;
                    showAlert('âœ… AI ìƒì„± ì™„ë£Œ!');
                } else {
                    responseBox.innerHTML = 'âš ï¸ AI ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
                }
                
            } catch (error) {
                console.error('AI ìƒì„± ì˜¤ë¥˜:', error);
                responseBox.innerHTML = `âš ï¸ ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!');
                return;
            }
            
            console.log('ì—…ë¡œë“œ ì‹œì‘:', file.name, file.size);
            
            const formData = new FormData();
            formData.append('file', file);
            
            const resultBox = document.getElementById('uploadResult');
            resultBox.innerHTML = '<div class="loading"></div> ì—…ë¡œë“œì¤‘...';
            
            try {
                const response = await fetch(`${API_URL}/api/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                console.log('ì—…ë¡œë“œ ì‘ë‹µ ìƒíƒœ:', response.status);
                const data = await response.json();
                console.log('ì—…ë¡œë“œ ì‘ë‹µ:', data);
                
                if (data.success) {
                    resultBox.innerHTML = `<strong>âœ… ì—…ë¡œë“œ ì„±ê³µ!</strong>
íŒŒì¼ëª…: ${data.data.original_name}
í¬ê¸°: ${data.data.size}
í˜•ì‹: ${data.data.type}
${data.data.analysis ? `
ë¶„ì„ ê²°ê³¼:
- ì¤„ ìˆ˜: ${data.data.analysis.lines}
- ë‹¨ì–´ ìˆ˜: ${data.data.analysis.words}
- ë¬¸ì ìˆ˜: ${data.data.analysis.characters}` : ''}`;
                    showAlert('âœ… íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ!');
                    fileInput.value = '';
                    loadStatistics();
                } else {
                    resultBox.innerHTML = `âš ï¸ ${data.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨'}`;
                }
            } catch (error) {
                console.error('íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                resultBox.innerHTML = `âš ï¸ ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        // Enter í‚¤ë¡œ ì‘ì—… ì¶”ê°€
        document.getElementById('taskInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });
    </script>
</body>
</html>